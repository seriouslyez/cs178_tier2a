{"version":3,"file":"domUtils.js","sources":["../../../src/utils/domUtils.ts"],"sourcesContent":["import type { FormControl, Obj, FieldValue, Touched } from '../types';\nimport {\n  isFormControl,\n  isFieldSetElement,\n  isInputElement,\n  isSelectElement,\n} from './typeGuards';\nimport { _get } from './get';\nimport { _set } from './set';\nimport { _update } from './update';\nimport { getPath } from './getPath';\n\n/**\n * @ignore\n */\nexport function getFormControls(el: Element): FormControl[] {\n  if (isFormControl(el)) return [el];\n  if (el.childElementCount === 0) return [];\n  const foundControls: Set<FormControl> = new Set();\n  for (const child of el.children) {\n    if (isFormControl(child)) foundControls.add(child);\n    if (isFieldSetElement(child)) {\n      for (const fieldsetChild of child.elements) {\n        if (isFormControl(fieldsetChild)) foundControls.add(fieldsetChild);\n      }\n    }\n    if (child.childElementCount > 0)\n      getFormControls(child).forEach((value) => foundControls.add(value));\n  }\n  return Array.from(foundControls);\n}\n\n/**\n * @ignore\n */\nexport function addAttrsFromFieldset(fieldSet: HTMLFieldSetElement): void {\n  for (const element of fieldSet.elements) {\n    if (!isFormControl(element) && !isFieldSetElement(element)) continue;\n    if (\n      fieldSet.hasAttribute('data-felte-keep-on-remove') &&\n      !element.hasAttribute('data-felte-keep-on-remove')\n    ) {\n      element.dataset.felteKeepOnRemove = fieldSet.dataset.felteKeepOnRemove;\n    }\n  }\n}\n\n/** @ignore */\nexport function getInputTextOrNumber(\n  el: FormControl\n): string | number | undefined {\n  if (el.type.match(/^(number|range)$/)) {\n    return !el.value ? undefined : +el.value;\n  } else {\n    return el.value;\n  }\n}\n\n/**\n * @ignore\n */\nexport function getFormDefaultValues<Data extends Obj>(\n  node: HTMLFormElement\n): { defaultData: Data; defaultTouched: Touched<Data> } {\n  let defaultData = {} as Data;\n  let defaultTouched = {} as Touched<Data>;\n  for (const el of node.elements) {\n    if (isFieldSetElement(el)) addAttrsFromFieldset(el);\n    if (!isFormControl(el) || !el.name) continue;\n    const elName = getPath(el);\n    if (isInputElement(el)) {\n      if (el.type === 'checkbox') {\n        if (typeof _get(defaultData, elName) === 'undefined') {\n          const checkboxes = Array.from(\n            node.querySelectorAll(`[name=\"${el.name}\"]`)\n          ).filter((checkbox) => {\n            if (!isFormControl(checkbox)) return false;\n            return elName === getPath(checkbox);\n          });\n          if (checkboxes.length === 1) {\n            defaultData = _set(defaultData, elName, el.checked);\n            defaultTouched = _set(defaultTouched, elName, false);\n            continue;\n          }\n          defaultData = _set(defaultData, elName, el.checked ? [el.value] : []);\n          defaultTouched = _set(defaultTouched, elName, false);\n          continue;\n        }\n        if (Array.isArray(_get(defaultData, elName)) && el.checked) {\n          defaultData = _update<Data>(defaultData, elName, (value) => [\n            ...value,\n            el.value,\n          ]);\n        }\n        continue;\n      }\n      if (el.type === 'radio') {\n        if (_get(defaultData, elName)) continue;\n        defaultData = _set(\n          defaultData,\n          elName,\n          el.checked ? el.value : undefined\n        );\n        defaultTouched = _set(defaultTouched, elName, false);\n        continue;\n      }\n      if (el.type === 'file') {\n        defaultData = _set(\n          defaultData,\n          elName,\n          el.multiple ? Array.from(el.files || []) : el.files?.[0]\n        );\n        defaultTouched = _set(defaultTouched, elName, false);\n        continue;\n      }\n    } else if (isSelectElement(el)) {\n      const multiple = el.multiple;\n      if (!multiple) {\n        defaultData = _set(defaultData, elName, el.value);\n      } else {\n        const selectedOptions = Array.from(el.options)\n          .filter((opt) => opt.selected)\n          .map((opt) => opt.value);\n        defaultData = _set(defaultData, elName, selectedOptions);\n      }\n      defaultTouched = _set(defaultTouched, elName, false);\n      continue;\n    }\n    const inputValue = getInputTextOrNumber(el);\n    defaultData = _set(defaultData, elName, inputValue);\n    defaultTouched = _set(defaultTouched, elName, false);\n  }\n  return { defaultData, defaultTouched };\n}\n\nexport function setControlValue(\n  el: FormControl,\n  value: FieldValue | FieldValue[]\n): void {\n  if (!isFormControl(el)) return;\n  const fieldValue = value;\n\n  if (isInputElement(el)) {\n    if (el.type === 'checkbox') {\n      const checkboxesDefaultData = fieldValue;\n      if (\n        typeof checkboxesDefaultData === 'undefined' ||\n        typeof checkboxesDefaultData === 'boolean'\n      ) {\n        el.checked = !!checkboxesDefaultData;\n        return;\n      }\n      if (Array.isArray(checkboxesDefaultData)) {\n        if ((checkboxesDefaultData as string[]).includes(el.value)) {\n          el.checked = true;\n        } else {\n          el.checked = false;\n        }\n      }\n      return;\n    }\n    if (el.type === 'radio') {\n      const radioValue = fieldValue;\n      if (el.value === radioValue) el.checked = true;\n      else el.checked = false;\n      return;\n    }\n    if (el.type === 'file') {\n      el.files = null;\n      el.value = '';\n      return;\n    }\n  } else if (isSelectElement(el)) {\n    const multiple = el.multiple;\n    if (!multiple) {\n      el.value = String(fieldValue ?? '');\n      for (const option of el.options) {\n        if (option.value === String(fieldValue)) {\n          option.selected = true;\n        } else {\n          option.selected = false;\n        }\n      }\n    } else if (Array.isArray(fieldValue)) {\n      el.value = String(fieldValue[0] ?? '');\n      const stringValues = fieldValue.map((v) => String(v));\n      for (const option of el.options) {\n        if (stringValues.includes(option.value)) {\n          option.selected = true;\n        } else {\n          option.selected = false;\n        }\n      }\n    }\n    return;\n  }\n\n  el.value = String(fieldValue ?? '');\n}\n\n/** Sets the form inputs value to match the data object provided. */\nexport function setForm<Data extends Obj>(\n  node: HTMLFormElement,\n  data: Data\n): void {\n  for (const el of node.elements) {\n    if (isFieldSetElement(el)) addAttrsFromFieldset(el);\n    if (!isFormControl(el) || !el.name) continue;\n    const elName = getPath(el);\n    setControlValue(el, _get(data, elName));\n  }\n}\n"],"names":[],"mappings":"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"}