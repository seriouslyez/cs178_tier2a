{"version":3,"file":"default-submit-handler.js","sources":["../../src/default-submit-handler.ts"],"sourcesContent":["import type { SuccessResponse, FetchResponse } from './error';\nimport { FelteSubmitError } from './error';\n\nexport function createDefaultSubmitHandler(form?: HTMLFormElement) {\n  if (!form) return;\n  return async function onSubmit(): Promise<SuccessResponse> {\n    let body: FormData | URLSearchParams = new FormData(form);\n    const action = new URL(form.action);\n    const method =\n      form.method.toLowerCase() === 'get'\n        ? 'get'\n        : action.searchParams.get('_method') || form.method;\n    let enctype = form.enctype;\n\n    if (form.querySelector('input[type=\"file\"]')) {\n      enctype = 'multipart/form-data';\n    }\n    if (method === 'get' || enctype === 'application/x-www-form-urlencoded') {\n      body = new URLSearchParams(body as any);\n    }\n\n    let fetchOptions: RequestInit;\n\n    if (method === 'get') {\n      (body as URLSearchParams).forEach((value, key) => {\n        action.searchParams.append(key, value);\n      });\n      fetchOptions = { method, headers: { Accept: 'application/json' } };\n    } else {\n      fetchOptions = {\n        method,\n        body,\n        headers: {\n          // If `Content-Type` is set on multipart/form-data, boundary will be missing\n          // See: https://github.com/pablo-abc/felte/issues/165\n          ...(enctype !== 'multipart/form-data' && {\n            'Content-Type': enctype,\n          }),\n          Accept: 'application/json',\n        },\n      };\n    }\n\n    const response: FetchResponse = await window.fetch(\n      action.toString(),\n      fetchOptions\n    );\n\n    if (response.ok) return response;\n    throw new FelteSubmitError(\n      'An error occurred while submitting the form',\n      response\n    );\n  };\n}\n"],"names":[],"mappings":";;AAGM,SAAU,0BAA0B,CAAC,IAAsB,EAAA;AAC/D,IAAA,IAAI,CAAC,IAAI;QAAE,OAAO;IAClB,OAAO,eAAe,QAAQ,GAAA;AAC5B,QAAA,IAAI,IAAI,GAA+B,IAAI,QAAQ,CAAC,IAAI,CAAC,CAAC;QAC1D,MAAM,MAAM,GAAG,IAAI,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACpC,MAAM,MAAM,GACV,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,KAAK,KAAK;AACjC,cAAE,KAAK;AACP,cAAE,MAAM,CAAC,YAAY,CAAC,GAAG,CAAC,SAAS,CAAC,IAAI,IAAI,CAAC,MAAM,CAAC;AACxD,QAAA,IAAI,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;AAE3B,QAAA,IAAI,IAAI,CAAC,aAAa,CAAC,oBAAoB,CAAC,EAAE;YAC5C,OAAO,GAAG,qBAAqB,CAAC;AACjC,SAAA;AACD,QAAA,IAAI,MAAM,KAAK,KAAK,IAAI,OAAO,KAAK,mCAAmC,EAAE;AACvE,YAAA,IAAI,GAAG,IAAI,eAAe,CAAC,IAAW,CAAC,CAAC;AACzC,SAAA;AAED,QAAA,IAAI,YAAyB,CAAC;QAE9B,IAAI,MAAM,KAAK,KAAK,EAAE;YACnB,IAAwB,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,GAAG,KAAI;gBAC/C,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;AACzC,aAAC,CAAC,CAAC;AACH,YAAA,YAAY,GAAG,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,MAAM,EAAE,kBAAkB,EAAE,EAAE,CAAC;AACpE,SAAA;AAAM,aAAA;AACL,YAAA,YAAY,GAAG;gBACb,MAAM;gBACN,IAAI;AACJ,gBAAA,OAAO,EAGF,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,EAAA,GAAC,OAAO,KAAK,qBAAqB,IAAI;AACvC,oBAAA,cAAc,EAAE,OAAO;AACxB,iBAAA,EACD,EAAA,EAAA,MAAM,EAAE,kBAAkB,EAC3B,CAAA;aACF,CAAC;AACH,SAAA;AAED,QAAA,MAAM,QAAQ,GAAkB,MAAM,MAAM,CAAC,KAAK,CAChD,MAAM,CAAC,QAAQ,EAAE,EACjB,YAAY,CACb,CAAC;QAEF,IAAI,QAAQ,CAAC,EAAE;AAAE,YAAA,OAAO,QAAQ,CAAC;AACjC,QAAA,MAAM,IAAI,gBAAgB,CACxB,6CAA6C,EAC7C,QAAQ,CACT,CAAC;AACJ,KAAC,CAAC;AACJ;;;;"}